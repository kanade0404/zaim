CREATE TABLE "user" ("id" BIGINT NOT NULL, "name" VARCHAR NOT NULL, PRIMARY KEY ("id"), UNIQUE ("name"));
CREATE TABLE "zaim_app" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "consumer_key" VARCHAR NOT NULL, "consumer_secret" VARCHAR NOT NULL, "user_id" BIGINT NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "unq_zaim_app" UNIQUE ("consumer_key", "consumer_secret", "user_id"), FOREIGN KEY ("user_id") REFERENCES "user" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "zaim_oauth" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "token" VARCHAR NOT NULL, "secret" VARCHAR NOT NULL, "zaim_app_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "unq_zaim_oauth" UNIQUE ("token", "secret", "zaim_app_id"), FOREIGN KEY ("zaim_app_id") REFERENCES "zaim_app" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "enable_zaim_app_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "zaim_app_id" uuid NOT NULL, "enabled" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_enable_zaim_app_event" UNIQUE ("zaim_app_id", "enabled"));
CREATE TABLE "enable_zaim_oauth_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "zaim_oauth_id" uuid NOT NULL, "enabled" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_enable_zaim_oauth_event" UNIQUE ("zaim_oauth_id", "enabled"), FOREIGN KEY ("zaim_oauth_id") REFERENCES "zaim_oauth" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "account" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "account_id" BIGINT NOT NULL, "user_id" BIGINT NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "unq_account" UNIQUE ("account_id", "user_id"), FOREIGN KEY ("user_id") REFERENCES "user" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "account_modified_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "account_id" uuid NOT NULL, "name" VARCHAR NOT NULL, "sort" BIGINT NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_account_modified_event" UNIQUE ("account_id", "name", "sort", "modified"), FOREIGN KEY ("account_id") REFERENCES "account" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "active_account" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "account_id" uuid NOT NULL, "activated" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_active_account" UNIQUE ("account_id", "activated"), FOREIGN KEY ("account_id") REFERENCES "account" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "inactive_account" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "account_id" uuid NOT NULL, "inactivated" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_inactive_account" UNIQUE ("account_id", "inactivated"), FOREIGN KEY ("account_id") REFERENCES "account" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "b43_account" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "account_id" uuid NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_b43_account" UNIQUE ("account_id", "modified"), FOREIGN KEY ("account_id") REFERENCES "account" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "modes" ("id" VARCHAR NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE "category" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "category_id" BIGINT NOT NULL, "user_id" BIGINT NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "unq_category" UNIQUE ("category_id", "user_id"), FOREIGN KEY ("user_id") REFERENCES "user" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "category_modified_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "category_id" uuid NOT NULL, "name" VARCHAR NOT NULL, "mode_id" VARCHAR NOT NULL, "sort" BIGINT NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_category_modified_event" UNIQUE ("category_id", "name", "mode_id", "sort", "modified"), FOREIGN KEY ("category_id") REFERENCES "category" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, FOREIGN KEY ("mode_id") REFERENCES "modes" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "active_category" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "category_id" uuid NOT NULL, "activated" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_active_category" UNIQUE ("category_id", "activated"), FOREIGN KEY ("category_id") REFERENCES "category" ("id")  );
CREATE TABLE "inactive_category" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "category_id" uuid NOT NULL, "inactivated_at" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_inactive_category" UNIQUE ("category_id", "inactivated_at"), FOREIGN KEY ("category_id") REFERENCES "category" ("id")  );
CREATE TABLE "genre" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "genre_id" BIGINT NOT NULL, "category_id" uuid NOT NULL, PRIMARY KEY ("id"), CONSTRAINT "unq_genre" UNIQUE ("genre_id", "category_id"), FOREIGN KEY ("category_id") REFERENCES "category" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "genre_modified_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "name" VARCHAR NOT NULL, "sort" BIGINT NOT NULL, "genre_id" uuid NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_genre_modified_event" UNIQUE ("name", "sort", "genre_id", "modified"), FOREIGN KEY ("genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "active_genre" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "genre_id" uuid NOT NULL, "activated" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_active_genre" UNIQUE ("genre_id", "activated"), FOREIGN KEY ("genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "inactive_genre" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "genre_id" uuid NOT NULL, "inactivated" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_inactive_genre" UNIQUE ("genre_id", "inactivated"), FOREIGN KEY ("genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "parent_genre_modified_event" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "child_genre_id" uuid NOT NULL, "parent_genre_id" uuid NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_parent_genre_modified_event" UNIQUE ("child_genre_id", "parent_genre_id", "modified"), FOREIGN KEY ("child_genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION, FOREIGN KEY ("parent_genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE TABLE "b43_genre" ("id" uuid NOT NULL DEFAULT gen_random_uuid(), "genre_id" uuid NOT NULL, "modified" TIMESTAMPTZ NOT NULL DEFAULT current_timestamp, PRIMARY KEY ("id"), CONSTRAINT "unq_b43_genre" UNIQUE ("genre_id", "modified"), FOREIGN KEY ("genre_id") REFERENCES "genre" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION);
CREATE INDEX "idx_user_name" ON "user" ("name");
CREATE INDEX "idx_zaim_app_user_id" ON "zaim_app" ("user_id");
CREATE INDEX "idx_zaim_oauth_zaim_app_id" ON "zaim_oauth" ("zaim_app_id");
CREATE INDEX "idx_account_modified_event_account_id" ON "account_modified_event" ("account_id");
CREATE INDEX "idx_account_modified_event_name" ON "account_modified_event" ("name");
CREATE INDEX "idx_category_category_id_user_id" ON "category" ("category_id", "user_id");
CREATE INDEX "idx_category_modified_event_category_id" ON "category_modified_event" ("category_id");
CREATE INDEX "idx_category_modified_event_name" ON "category_modified_event" ("name");
CREATE INDEX "idx_category_modified_event_mode_id" ON "category_modified_event" ("mode_id");
CREATE INDEX "idx_category_modified_event_modified" ON "category_modified_event" ("modified");
CREATE INDEX "idx_active_category_category_id_activated" ON "active_category" ("category_id", "activated");
CREATE INDEX "idx_inactive_category_category_id_inactivated_at" ON "inactive_category" ("category_id", "inactivated_at");
CREATE INDEX "idx_genre_category_id" ON "genre" ("category_id");
CREATE INDEX "idx_genre_modified_event_genre_id" ON "genre_modified_event" ("genre_id");
CREATE INDEX "idx_genre_modified_event_name" ON "genre_modified_event" ("name");
CREATE INDEX "idx_genre_modified_event_modified" ON "genre_modified_event" ("modified");
CREATE INDEX "idx_parent_genre_modified_event_child_genre_id" ON "parent_genre_modified_event" ("child_genre_id");
CREATE INDEX "idx_parent_genre_modified_event_parent_genre_id" ON "parent_genre_modified_event" ("parent_genre_id");
CREATE INDEX "idx_parent_genre_modified_event_modified" ON "parent_genre_modified_event" ("modified");
